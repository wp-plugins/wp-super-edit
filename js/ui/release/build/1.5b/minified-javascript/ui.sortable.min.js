(function(A){if(window.Node&&Node.prototype&&!Node.prototype.contains){Node.prototype.contains=function(B){return !!(this.compareDocumentPosition(B)&16)}}A.fn.extend({sortable:function(C){var B=Array.prototype.slice.call(arguments,1);if(C=="serialize"){return A.data(this[0],"ui-sortable").serialize(arguments[1])}return this.each(function(){if(typeof C=="string"){var D=A.data(this,"ui-sortable");D[C].apply(D,B)}else{if(!A.data(this,"ui-sortable")){new A.ui.sortable(this,C)}}})}});A.ui.sortable=function(D,C){var B=this;this.element=A(D);A.data(D,"ui-sortable",this);this.element.addClass("ui-sortable");this.options=A.extend({},C);var E=this.options;A.extend(E,{items:this.options.items||"> *",zIndex:this.options.zIndex||1000,startCondition:function(){return !B.disabled}});A(D).bind("setData.sortable",function(G,F,H){B.options[F]=H}).bind("getData.sortable",function(G,F){return B.options[F]});this.refresh();this.floating=/left|right/.test(this.items[0].item.css("float"));if(!(/(relative|absolute|fixed)/).test(this.element.css("position"))){this.element.css("position","relative")}this.offset=this.element.offset({border:false});this.element.mouseInteraction({executor:this,delay:E.delay,distance:E.distance||0,dragPrevention:E.prevention?E.prevention.toLowerCase().split(","):["input","textarea","button","select","option"],start:this.start,stop:this.stop,drag:this.drag,condition:function(H){if(this.disabled){return false}var G=null,F=A(H.target).parents().andSelf().each(function(){if(A.data(this,"ui-sortable-item")){G=A(this)}});if(G&&(!this.options.handle||A(H.target).parents().andSelf().is(this.options.handle))){this.currentItem=G;return true}else{return false}}})};A.extend(A.ui.sortable.prototype,{plugins:{},ui:function(){return{helper:this.helper,placeholder:this.placeholder||A([]),position:this.position,absolutePosition:this.positionAbs,instance:this,options:this.options}},propagate:function(C,B){A.ui.plugin.call(this,C,[B,this.ui()]);this.element.triggerHandler(C=="sort"?C:"sort"+C,[B,this.ui()],this.options[C])},serialize:function(D){var B=A(this.options.items,this.element).not(".ui-sortable-helper");var C=[];D=D||{};B.each(function(){var E=(this.getAttribute(D.attribute||"id")||"").match(D.expression||(/(.+)[-=_](.+)/));if(E){C.push((D.key||E[1])+"[]="+(D.key?E[1]:E[2]))}});return C.join("&")},intersectsWith:function(I){var D=this.positionAbs.left,C=D+this.helperProportions.width,H=this.positionAbs.top,G=H+this.helperProportions.height;var E=I.left,B=E+I.width,J=I.top,F=J+I.height;return(E<D+(this.helperProportions.width/2)&&C-(this.helperProportions.width/2)<B&&J<H+(this.helperProportions.height/2)&&G-(this.helperProportions.height/2)<F)},refresh:function(){this.items=[];var B=this.items;var C=[A(this.options.items,this.element)];if(this.options.connectWith){for(var D=this.options.connectWith.length-1;D>=0;D--){var E=A.data(A(this.options.connectWith[D])[0],"ui-sortable");if(E&&!E.disabled){C.push(A(E.options.items,E.element))}}}for(var D=C.length-1;D>=0;D--){C[D].each(function(){A.data(this,"ui-sortable-item",true);B.push({item:A(this),width:0,height:0,left:0,top:0})})}},refreshPositions:function(B){for(var C=this.items.length-1;C>=0;C--){if(!B){this.items[C].width=this.items[C].item.outerWidth()}if(!B){this.items[C].height=this.items[C].item.outerHeight()}var D=this.items[C].item.offset();this.items[C].left=D.left;this.items[C].top=D.top}},destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").removeData("ui-sortable").unbind(".sortable").removeMouseInteraction();for(var B=this.items.length-1;B>=0;B--){this.items[B].item.removeData("ui-sortable-item")}},enable:function(){this.element.removeClass("ui-sortable-disabled");this.disabled=false},disable:function(){this.element.addClass("ui-sortable-disabled");this.disabled=true},createPlaceholder:function(){this.placeholderElement=this.options.placeholderElement?A(this.options.placeholderElement,this.currentItem):this.currentItem;this.placeholder=A("<div></div>").addClass(this.options.placeholder).appendTo("body").css({position:"absolute"}).css(this.placeholderElement.offset()).css({width:this.placeholderElement.outerWidth(),height:this.placeholderElement.outerHeight()})},recallOffset:function(D){var C={left:this.elementOffset.left-this.offsetParentOffset.left,top:this.elementOffset.top-this.offsetParentOffset.top};var B=this.helper.css("position")=="relative";this.originalPosition={left:(B?parseInt(this.helper.css("left"),10)||0:C.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft)),top:(B?parseInt(this.helper.css("top"),10)||0:C.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop))};this.offset={left:this._pageX-this.originalPosition.left+(parseInt(this.currentItem.css("marginLeft"),10)||0),top:this._pageY-this.originalPosition.top+(parseInt(this.currentItem.css("marginTop"),10)||0)}},start:function(D){var E=this.options;this.refresh();this.refreshPositions();this.helper=typeof E.helper=="function"?A(E.helper.apply(this.element[0],[D,this.currentItem])):this.currentItem.clone();this.helper.appendTo(this.currentItem[0].parentNode).css({position:"absolute",clear:"both"}).addClass("ui-sortable-helper");this.offsetParent=(function(F){while(F){if(F.style&&(/(absolute|relative|fixed)/).test(A.css(F,"position"))){return A(F)}F=F.parentNode?F.parentNode:null}return A("body")})(this.helper[0].parentNode);this.elementOffset=this.currentItem.offset();this.offsetParentOffset=this.offsetParent.offset();var C={left:this.elementOffset.left-this.offsetParentOffset.left,top:this.elementOffset.top-this.offsetParentOffset.top};this._pageX=D.pageX;this._pageY=D.pageY;this.clickOffset={left:D.pageX-this.elementOffset.left,top:D.pageY-this.elementOffset.top};var B=this.helper.css("position")=="relative";this.originalPosition={left:(B?parseInt(this.helper.css("left"),10)||0:C.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft)),top:(B?parseInt(this.helper.css("top"),10)||0:C.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop))};this.offset={left:D.pageX-this.originalPosition.left+(parseInt(this.currentItem.css("marginLeft"),10)||0),top:D.pageY-this.originalPosition.top+(parseInt(this.currentItem.css("marginTop"),10)||0)};this.position={top:D.pageY-this.offset.top,left:D.pageX-this.offset.left};this.positionAbs={left:D.pageX-this.clickOffset.left,top:D.pageY-this.clickOffset.top};this.positionDOM=this.currentItem.prev()[0];if(E.placeholder){this.createPlaceholder()}this.propagate("start",D);this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()};A(this.currentItem).css("visibility","hidden");return false},stop:function(B){this.propagate("stop",B);if(this.positionDOM!=this.currentItem.prev()[0]){this.propagate("update",B)}if(this.cancelHelperRemoval){return false}A(this.currentItem).css("visibility","");if(this.placeholder){this.placeholder.remove()}this.helper.remove();return false},drag:function(C){this.direction=(this.floating&&this.positionAbs.left>C.pageX-this.clickOffset.left)||(this.positionAbs.top>C.pageY-this.clickOffset.top)?"down":"up";this.position={top:C.pageY-this.offset.top,left:C.pageX-this.offset.left};this.positionAbs={left:C.pageX-this.clickOffset.left,top:C.pageY-this.clickOffset.top};for(var B=this.items.length-1;B>=0;B--){if(this.intersectsWith(this.items[B])&&this.items[B].item[0]!=this.currentItem[0]&&(this.options.tree?!this.currentItem[0].contains(this.items[B].item[0]):true)){this.items[B].item[this.direction=="down"?"before":"after"](this.currentItem);this.refreshPositions(true);if(this.placeholderElement){this.placeholder.css(this.placeholderElement.offset())}this.propagate("change",C);break}}this.propagate("sort",C);this.helper.css({left:this.position.left+"px",top:this.position.top+"px"});return false}})})(jQuery);