(function(A){A.fn.extend({droppable:function(C){var B=Array.prototype.slice.call(arguments,1);return this.each(function(){if(typeof C=="string"){var D=A.data(this,"ui-droppable");D[C].apply(D,B)}else{if(!A.data(this,"ui-droppable")){new A.ui.droppable(this,C)}}})}});A.ui.droppable=function(D,B){this.element=A(D);A.data(D,"ui-droppable",this);this.element.addClass("ui-droppable");this.options=A.extend({},B);var E=this.options;var C=E.accept;A.extend(E,{accept:E.accept&&E.accept.constructor==Function?E.accept:function(F){return A(F).is(C)},tolerance:E.tolerance||"intersect"});A(D).bind("setData.draggable",function(G,F,H){E[F]=H}).bind("getData.draggable",function(G,F){return E[F]});this.proportions={width:this.element.outerWidth(),height:this.element.outerHeight()};A.ui.ddmanager.droppables.push({item:this,over:0,out:1})};A.extend(A.ui.droppable.prototype,{plugins:{},ui:function(B){return{instance:this,draggable:B.element,helper:B.helper,position:B.position,absolutePosition:B.positionAbs,options:this.options}},destroy:function(){var B=A.ui.ddmanager.droppables;for(var C=0;C<B.length;C++){if(B[C].item==this){B.splice(C,1)}}this.element.removeClass("ui-droppable ui-droppable-disabled").removeData("ui-droppable").unbind(".droppable")},enable:function(){this.element.removeClass("ui-droppable-disabled");this.disabled=false},disable:function(){this.element.addClass("ui-droppable-disabled");this.disabled=true},over:function(C){var B=A.ui.ddmanager.current;if(!B||B.element[0]==this.element[0]){return }if(this.options.accept.call(this.element,B.element)){A.ui.plugin.call(this,"over",[C,this.ui(B)]);this.element.triggerHandler("dropover",[C,this.ui(B)],this.options.over)}},out:function(C){var B=A.ui.ddmanager.current;if(!B||B.element[0]==this.element[0]){return }if(this.options.accept.call(this.element,B.element)){A.ui.plugin.call(this,"out",[C,this.ui(B)]);this.element.triggerHandler("dropout",[C,this.ui(B)],this.options.out)}},drop:function(C){var B=A.ui.ddmanager.current;if(!B||B.element[0]==this.element[0]){return }if(this.options.accept.call(this.element,B.element)){A.ui.plugin.call(this,"drop",[C,this.ui(B)]);this.element.triggerHandler("drop",[C,this.ui(B)],this.options.drop)}},activate:function(C){var B=A.ui.ddmanager.current;A.ui.plugin.call(this,"activate",[C,this.ui(B)]);if(B){this.element.triggerHandler("dropactivate",[C,this.ui(B)],this.options.activate)}},deactivate:function(C){var B=A.ui.ddmanager.current;A.ui.plugin.call(this,"deactivate",[C,this.ui(B)]);if(B){this.element.triggerHandler("dropdeactivate",[C,this.ui(B)],this.options.deactivate)}}});A.ui.intersect=function(L,F,J){if(!F.offset){return false}var D=L.positionAbs.left,C=D+L.helperProportions.width,I=L.positionAbs.top,H=I+L.helperProportions.height;var E=F.offset.left,B=E+F.item.proportions.width,K=F.offset.top,G=K+F.item.proportions.height;switch(J){case"fit":return(E<D&&C<B&&K<I&&H<G);break;case"intersect":return(E<D+(L.helperProportions.width/2)&&C-(L.helperProportions.width/2)<B&&K<I+(L.helperProportions.height/2)&&H-(L.helperProportions.height/2)<G);break;case"pointer":return(E<(L.positionAbs.left+L.clickOffset.left)&&(L.positionAbs.left+L.clickOffset.left)<B&&K<(L.positionAbs.top+L.clickOffset.top)&&(L.positionAbs.top+L.clickOffset.top)<G);break;case"touch":return((E<D&&D<B&&K<I&&I<G)||(E<D&&D<B&&K<H&&H<G)||(E<C&&C<B&&K<I&&I<G)||(E<C&&C<B&&K<H&&H<G));break;default:return false;break}};A.ui.ddmanager={current:null,droppables:[],prepareOffsets:function(D,E){var B=A.ui.ddmanager.droppables;for(var C=0;C<B.length;C++){if(B[C].item.disabled||(D&&!B[C].item.options.accept.call(B[C].item.element,D.element))){continue}B[C].offset=A(B[C].item.element).offset();if(D){B[C].item.activate.call(B[C].item,E)}}},drop:function(B,C){A.each(A.ui.ddmanager.droppables,function(){if(!this.item.disabled&&A.ui.intersect(B,this,this.item.options.tolerance)){this.item.drop.call(this.item,C)}if(!this.item.disabled&&this.item.options.accept.call(this.item.element,B.element)){this.out=1;this.over=0;this.item.deactivate.call(this.item,C)}})},drag:function(B,C){if(B.options.refreshPositions){A.ui.ddmanager.prepareOffsets()}A.each(A.ui.ddmanager.droppables,function(){if(this.item.disabled){return false}var D=A.ui.intersect(B,this,this.item.options.tolerance);var E=!D&&this.over==1?"out":(D&&this.over==0?"over":null);if(!E){return }this[E]=1;this[E=="out"?"over":"out"]=0;this.item[E].call(this.item,C)})}}})(jQuery);